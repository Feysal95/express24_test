# Задание
Необходимо реализовать сервис с следующим функционалом с на языке PHP 7.0+

В базе данных MySQL/Postgresql должна быть таблица currency c колонками:

id — первичный ключ
name — название валюты
rate — курс валюты к рублю

Должна быть консольная команда для обновления данных в таблице currency. Данные по курсам валют можно взять отсюда: http://www.cbr.ru/scripts/XML_daily.asp

Реализовать 2 REST API метода:
- GET /currencies — должен возвращать список курсов валют с возможность пагинации
- GET /currency/ — должен возвращать курс валюты для переданного id

API должно быть закрыто bearer авторизацией.

*Будет плюсом:
- Использования ООП и Паттернов

## Реализация

Реализовал с помощью фреймворка symfony.

Все обернул в докер, должен запуститься на Линуксе или Убунте без проблем

Парсинг происходит посредством библиотеки Crawler

Все хранится в Mariadb

## Run

Для запуска необходимо иметь линукс, мак с установленными актуальными doker и docker-compose

Также необходимо освободить порты 80 3306 10000

Собирается это все примерно так:

```
cd docker
./install
```

Во время выполнения скрипта произойдет следующее:

1. Соберется 3 контейнера с php-fpm, mariadb и openresty
2. Накатиться структура базы
3. Установятся пакеты композера
4. Выплнится парсинг курса валют
5. Контейнеры остановятся

Чтобы запустить контейнеры заново

```
docker-compose up -d
```

Сайт будет доступен на 80 порту [http://localhost:80](http://localhost:80/).

Парсинг сделан через консольку... для запуска можно выполнить внутри контейнера php-fpm

```
php bin/console ParseCurrencies
```

Или можно с локальной кнсольки выполнив 
```
docker exec -ti php-fpm sh -c "php bin/console ParseCurrencies"
```

API

```
http://localhost/currencies?p=1&limit=5
```

возвращает список курсов валют

Где гет-параметр `p` - это страница пагинации,
а гет-параметр `limit` - количество элементов на странице
По умолчанию p = 1, limit = 40
```
http://localhost/currency/10
```

Где `10` - это конкретный ID курса валют

АВТОРИЗАЦИЯ

Для авторизации воспользовался готовым компонентом symfony/security-bundle

Используется псевдопользователь (пользователей нет и информации о них мы не храним), то переопределяем у провайдера App\Security\UserProvider метод получения пользователя loadUserByUsername($username). Просто инициализируем пустой объект App\Security\User и в качестве username сетим ему токен полученный из реквеста

Следует передавать заголовок - X-Auth-Token . Пример : https://o525.ru/_E_2cJ2rJfbnAFM0kyCsHOYR3Hk

В `.env` - X_AUTH_TOKEN - хранится значение токена, на которое будет проверяться запрос